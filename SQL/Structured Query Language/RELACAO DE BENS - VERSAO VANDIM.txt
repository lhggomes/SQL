SELECT BP.DATAENTRADA,P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO,
COUNT(BP.CODPROD) AS QTD, SUM(BP.VLRATUALBEM) AS VLTOTAL
FROM PCBENSPATRIMONIAIS BP, PCPRODCIAP P, PCBENSGRUPO G
WHERE BP.CODPROD = P.CODPROD
AND P.CODGRUPOBEM = G.CODGRUPO(+)
AND BP.DATAENTRADA <= :DATA2
AND ((BP.DATABAIXA IS NULL OR  ((:DATA2 <= BP.DATABAIXA) AND (BP.TIPOBAIXA <> 'TR')) OR ((:DATA2 < BP.DATABAIXA)))
        OR (BP.DATABAIXA IS NOT NULL AND BP.TIPOBAIXA IN ('P4', 'P5', 'DT')))
--AND BP.DATAENTRADA >= TRUNC(SYSDATE-30)
--AND M.CODOPER IN ('SD')
AND BP.CODFILIAL = :CODFILIAL
AND G.CODGRUPO = :CODGRUPO 
GROUP BY BP.DATAENTRADA,P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO
ORDER BY 1, 4, 2