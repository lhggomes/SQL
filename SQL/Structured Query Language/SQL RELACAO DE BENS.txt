SELECT BP.DATAENTRADA,BP.CODFILIAL, FL.CGC AS CNPJ, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO,
COUNT(BP.CODPROD) AS QTD, SUM(BP.VLRATUALBEM) AS VLTOTAL
FROM PCBENSPATRIMONIAIS BP, PCPRODCIAP P, PCBENSGRUPO G, PCFILIAL FL
WHERE :TIPORELATORIO = 'POSICAO ATUAL DO ESTOQUE' 
AND BP.CODFILIAL = FL.CODIGO
AND BP.CODPROD = P.CODPROD
AND P.CODGRUPOBEM = G.CODGRUPO(+)
AND BP.DATAENTRADA <= :DATA2
AND ((BP.DATABAIXA IS NULL OR  ((:DATA2 <= BP.DATABAIXA) AND (BP.TIPOBAIXA <> 'TR')) OR ((:DATA2 < BP.DATABAIXA)))
OR (BP.DATABAIXA IS NOT NULL AND BP.TIPOBAIXA IN ('P4', 'P5', 'DT')))
--AND BP.DATAENTRADA >= TRUNC(SYSDATE-30)
--AND M.CODOPER IN ('SD')
AND BP.CODFILIAL = :CODFILIAL
AND G.CODGRUPO = :CODGRUPO 
GROUP BY BP.DATAENTRADA,BP.CODFILIAL, FL.CGC, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO
UNION  
SELECT BP.DATAENTRADA,BP.CODFILIAL, FL.CGC AS CNPJ, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO,
COUNT(BP.CODPROD) AS QTD, SUM(BP.VLRATUALBEM) AS VLTOTAL
FROM PCBENSPATRIMONIAIS BP, PCPRODCIAP P, PCBENSGRUPO G, PCFILIAL FL
WHERE :TIPORELATORIO = 'ENTRADAS NO PERIODO' 
AND BP.CODFILIAL = FL.CODIGO
AND BP.CODPROD = P.CODPROD
AND P.CODGRUPOBEM = G.CODGRUPO
AND BP.DATAENTRADA = :DATA2
AND BP.CODFILIAL = :CODFILIAL
AND G.CODGRUPO = :CODGRUPO 
GROUP BY BP.DATAENTRADA,BP.CODFILIAL, FL.CGC, FL.RAZAOSOCIAL,  P.CODPROD,P.DESCRICAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO

PCBENSPATRIMONIAIS
PCBENSLOCALIZACAO L, PCBENSRESPONSAVEL R

NOVA VERSAO 

SELECT BP.DATAENTRADA,BP.CODFILIAL, FL.CGC AS CNPJ, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.TAXADEPRECIACAO,  BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO, L.DESCLOCALIZACAO AS LOCALIZACAO, R.DESCRESPONSAVEL AS RESPONSAVEL,
COUNT(BP.CODPROD) AS QTD, SUM(BP.VLRATUALBEM) AS VLTOTAL
--(SELECT NOME AS USUARIOLOGADO FROM PCEMPR WHERE CODUSUARIOLOGADO = MATRICULA)
FROM PCBENSPATRIMONIAIS BP, PCPRODCIAP P, PCBENSGRUPO G, PCFILIAL FL, PCBENSLOCALIZACAO L, PCBENSRESPONSAVEL R
WHERE :TIPORELATORIO = 'POSICAO ATUAL DO ESTOQUE' 
AND NVL(BP.CODRESPONSAVELBEM,'') = NVL(R.CODRESPONSAVEL, '')
AND  NVL(BP.CODLOCALIZACAOBEM,'') = NVL(L.CODLOCALIZACAO, '')
AND BP.CODFILIAL = FL.CODIGO
AND BP.CODPROD = P.CODPROD
AND P.CODGRUPOBEM = G.CODGRUPO(+)
AND BP.DATAENTRADA <= :DATA2
AND ((BP.DATABAIXA IS NULL OR  ((:DATA2 <= BP.DATABAIXA) AND (BP.TIPOBAIXA <> 'TR')) OR ((:DATA2 < BP.DATABAIXA)))
OR (BP.DATABAIXA IS NOT NULL AND BP.TIPOBAIXA IN ('P4', 'P5', 'DT')))
--AND BP.DATAENTRADA >= TRUNC(SYSDATE-30)
--AND M.CODOPER IN ('SD')
AND BP.CODFILIAL = :CODFILIAL
AND G.CODGRUPO = :CODGRUPO 
GROUP BY BP.DATAENTRADA,BP.CODFILIAL, FL.CGC, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.TAXADEPRECIACAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO, L.DESCLOCALIZACAO, R.DESCRESPONSAVEL
UNION  
SELECT BP.DATAENTRADA,BP.CODFILIAL, FL.CGC AS CNPJ, FL.RAZAOSOCIAL, P.CODPROD,P.DESCRICAO, BP.TAXADEPRECIACAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO, L.DESCLOCALIZACAO AS LOCALIZAO, R.DESCRESPONSAVEL AS RESPONSAVEL,
COUNT(BP.CODPROD) AS QTD, SUM(BP.VLRATUALBEM) AS VLTOTAL
--(SELECT NOME AS USUARIOLOGADO FROM PCEMPR WHERE CODUSUARIOLOGADO = MATRICULA)
FROM PCBENSPATRIMONIAIS BP, PCPRODCIAP P, PCBENSGRUPO G, PCFILIAL FL, PCBENSLOCALIZACAO L, PCBENSRESPONSAVEL R
WHERE :TIPORELATORIO = 'ENTRADAS NO PERIODO' 
AND NVL(BP.CODRESPONSAVELBEM,'') = NVL(R.CODRESPONSAVEL, '')
AND NVL(BP.CODLOCALIZACAOBEM,'')= NVL(L.CODLOCALIZACAO, '')
AND BP.CODFILIAL = FL.CODIGO
AND BP.CODPROD = P.CODPROD
AND P.CODGRUPOBEM = G.CODGRUPO
AND BP.DATAENTRADA = :DATA2
AND BP.CODFILIAL = :CODFILIAL
AND G.CODGRUPO = :CODGRUPO 
GROUP BY BP.DATAENTRADA,BP.CODFILIAL, FL.CGC, FL.RAZAOSOCIAL,  P.CODPROD,P.DESCRICAO,BP.TAXADEPRECIACAO, BP.NUMNOTA, BP.NUMTRANSACAO,
G.CODGRUPO,G.DESCGRUPO, L.DESCLOCALIZACAO, R.DESCRESPONSAVEL

